# Homelab Infrastructure Architecture Diagrams

*Last updated: December 19, 2025*

## Table of Contents

1. [High-Level Overview](#high-level-overview)
2. [Network Architecture](#network-architecture)
3. [VLAN Layout](#vlan-layout)
4. [Proxmox Cluster Topology](#proxmox-cluster-topology)
5. [Kubernetes Cluster](#kubernetes-cluster)
6. [Application Services](#application-services)
7. [Arr Media Stack Connections](#arr-media-stack-connections)
8. [Storage Architecture](#storage-architecture)
9. [Traffic Flow](#traffic-flow)
10. [DNS & SSL Flow](#dns--ssl-flow)

---

## High-Level Overview

```
                                    ┌─────────────────────────────────────────────────────────────────┐
                                    │                        INTERNET                                  │
                                    └─────────────────────────────────┬───────────────────────────────┘
                                                                      │
                                                                      ▼
                                    ┌─────────────────────────────────────────────────────────────────┐
                                    │                    OPNsense Firewall                             │
                                    │                     192.168.91.30                                │
                                    │              (DNS Server + Gateway)                              │
                                    └─────────────────────────────────┬───────────────────────────────┘
                                                                      │
                          ┌───────────────────────────────────────────┴───────────────────────────────────────────┐
                          │                                                                                       │
                          ▼                                                                                       ▼
     ┌────────────────────────────────────────────────────────┐      ┌────────────────────────────────────────────────────────┐
     │                    VLAN 20                              │      │                    VLAN 40                              │
     │            Kubernetes Infrastructure                    │      │              Services & Management                     │
     │                192.168.20.0/24                          │      │                192.168.40.0/24                          │
     │                                                         │      │                                                         │
     │  ┌─────────────────────────────────────────────────┐   │      │  ┌─────────────────────────────────────────────────┐   │
     │  │           Proxmox Cluster (3 nodes)             │   │      │  │              Application VMs                    │   │
     │  │  node01 (.20) │ node02 (.21) │ node03 (.22)    │   │      │  │                                                 │   │
     │  └─────────────────────────────────────────────────┘   │      │  │  Traefik (.20)    │  Authentik (.21)           │   │
     │                                                         │      │  │  Immich (.22)     │  GitLab (.23)              │   │
     │  ┌─────────────────────────────────────────────────┐   │      │  │  Docker-Media (.11) │ Docker-Utils (.10)       │   │
     │  │           Kubernetes Cluster (9 nodes)          │   │      │  │  Syslog (.5)                                   │   │
     │  │  Controllers: .32, .33, .34                     │   │      │  └─────────────────────────────────────────────────┘   │
     │  │  Workers: .40, .41, .42, .43, .44, .45          │   │      │                                                         │
     │  └─────────────────────────────────────────────────┘   │      └────────────────────────────────────────────────────────┘
     │                                                         │
     │  ┌─────────────────────────────────────────────────┐   │
     │  │           Ansible Controller (.30)              │   │      ┌────────────────────────────────────────────────────────┐
     │  └─────────────────────────────────────────────────┘   │      │                  Synology NAS                          │
     │                                                         │      │                 192.168.20.31                          │
     └────────────────────────────────────────────────────────┘      │           (NFS Storage for all VMs)                   │
                                                                      └────────────────────────────────────────────────────────┘
```

---

## Network Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                           PHYSICAL NETWORK                                                       │
│                                                                                                                  │
│    ┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐    │
│    │                                    Layer 2 Switch (VLAN Trunk)                                        │    │
│    │                                                                                                        │    │
│    │    Port 1-3: Proxmox Nodes (Tagged VLAN 20, 40)                                                       │    │
│    │    Port 4: Synology NAS (VLAN 20)                                                                     │    │
│    │    Port 5: OPNsense (Trunk)                                                                           │    │
│    └──────────────────────────────────────────────────────────────────────────────────────────────────────┘    │
│                                                    │                                                             │
│                    ┌───────────────────────────────┴───────────────────────────────┐                            │
│                    │                                                               │                            │
│                    ▼                                                               ▼                            │
│    ┌─────────────────────────────────────┐                     ┌─────────────────────────────────────┐         │
│    │          VLAN 20 (Native)           │                     │           VLAN 40 (Tagged)          │         │
│    │     Kubernetes Infrastructure       │                     │       Services & Management         │         │
│    │        192.168.20.0/24              │                     │         192.168.40.0/24             │         │
│    │        GW: 192.168.20.1             │                     │         GW: 192.168.40.1            │         │
│    └─────────────────────────────────────┘                     └─────────────────────────────────────┘         │
│                                                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                           PROXMOX BRIDGE CONFIG                                                  │
│                                                                                                                  │
│    All Nodes: vmbr0 (VLAN-aware bridge)                                                                         │
│    ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐      │
│    │  bridge-vlan-aware yes                                                                              │      │
│    │  bridge-vids 2-4094                                                                                 │      │
│    │  bridge-ports nic0                                                                                  │      │
│    └────────────────────────────────────────────────────────────────────────────────────────────────────┘      │
│                                                                                                                  │
│    VM Network Assignment:                                                                                        │
│    - VLAN 20: vlan_tag = null (untagged/native)                                                                 │
│    - VLAN 40: vlan_tag = 40 (tagged)                                                                            │
│                                                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## VLAN Layout

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                              VLAN 20 - 192.168.20.0/24                                          │
│                                           Kubernetes Infrastructure                                              │
├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                  │
│  ┌─────────────────────────────┐  ┌─────────────────────────────┐  ┌─────────────────────────────┐             │
│  │      PROXMOX CLUSTER        │  │        KUBERNETES           │  │         SUPPORT             │             │
│  ├─────────────────────────────┤  ├─────────────────────────────┤  ├─────────────────────────────┤             │
│  │ .20  node01 (VM Host)       │  │ .32  k8s-controller01       │  │ .30  ansible-controller01   │             │
│  │ .21  node02 (LXC Host)      │  │ .33  k8s-controller02       │  │ .31  synology-nas01         │             │
│  │ .22  node03 (General)       │  │ .34  k8s-controller03       │  │                             │             │
│  └─────────────────────────────┘  │ .40  k8s-worker01           │  │ RESERVED:                   │             │
│                                    │ .41  k8s-worker02           │  │ .46-.99   Future K8s       │             │
│                                    │ .42  k8s-worker03           │  │ .100-.199 LXC Containers   │             │
│                                    │ .43  k8s-worker04           │  │ .200-.254 Future VMs       │             │
│                                    │ .44  k8s-worker05           │  └─────────────────────────────┘             │
│                                    │ .45  k8s-worker06           │                                               │
│                                    └─────────────────────────────┘                                               │
│                                                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                              VLAN 40 - 192.168.40.0/24                                          │
│                                             Services & Management                                                │
├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                  │
│  ┌─────────────────────────────┐  ┌─────────────────────────────┐  ┌─────────────────────────────┐             │
│  │      INFRASTRUCTURE         │  │       DOCKER HOSTS          │  │     APPLICATION VMs         │             │
│  ├─────────────────────────────┤  ├─────────────────────────────┤  ├─────────────────────────────┤             │
│  │ .5   linux-syslog-server01  │  │ .10  docker-vm-utilities01  │  │ .20  traefik-vm01           │             │
│  │                             │  │      - Paperless-ngx        │  │ .21  authentik-vm01         │             │
│  │                             │  │      - Glance Dashboard     │  │ .22  immich-vm01            │             │
│  │                             │  │      - n8n Automation       │  │ .23  gitlab-vm01            │             │
│  │                             │  │                             │  │                             │             │
│  │                             │  │ .11  docker-vm-media01      │  │ RESERVED:                   │             │
│  │                             │  │      - Jellyfin             │  │ .24-.29  Future Apps        │             │
│  │                             │  │      - Radarr/Sonarr/Lidarr │  │ .30-.39  Monitoring         │             │
│  │                             │  │      - Prowlarr/Bazarr      │  │ .40-.254 Future Services    │             │
│  │                             │  │      - Jellyseerr           │  └─────────────────────────────┘             │
│  │                             │  │      - Tdarr/Autobrr        │                                               │
│  └─────────────────────────────┘  └─────────────────────────────┘                                               │
│                                                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## Proxmox Cluster Topology

```
                                    ┌─────────────────────────────────────────┐
                                    │         PROXMOX VE CLUSTER              │
                                    │            (3 Nodes, HA)                │
                                    └─────────────────────────────────────────┘
                                                       │
                    ┌──────────────────────────────────┼──────────────────────────────────┐
                    │                                  │                                  │
                    ▼                                  ▼                                  ▼
     ┌──────────────────────────────┐ ┌──────────────────────────────┐ ┌──────────────────────────────┐
     │          NODE01              │ │          NODE02              │ │          NODE03              │
     │      192.168.20.20           │ │      192.168.20.21           │ │      192.168.20.22           │
     │        (VM Host)             │ │       (LXC Host)             │ │     (General Purpose)        │
     ├──────────────────────────────┤ ├──────────────────────────────┤ ├──────────────────────────────┤
     │                              │ │                              │ │                              │
     │  VMs Hosted:                 │ │  VMs Hosted:                 │ │  VMs Hosted:                 │
     │  - ansible-controller01     │ │  - linux-syslog-server01    │ │  - k8s-controller01          │
     │                              │ │  - docker-vm-utilities01    │ │  - k8s-controller02          │
     │                              │ │  - docker-vm-media01        │ │  - k8s-controller03          │
     │  Templates:                  │ │  - traefik-vm01             │ │  - k8s-worker01              │
     │  - tpl-ubuntuv24.04-v1      │ │  - authentik-vm01           │ │  - k8s-worker02              │
     │  - tpl-ubuntu-shared-v1     │ │  - immich-vm01              │ │  - k8s-worker03              │
     │                              │ │  - gitlab-vm01              │ │  - k8s-worker04              │
     │                              │ │                              │ │  - k8s-worker05              │
     │                              │ │                              │ │  - k8s-worker06              │
     │                              │ │                              │ │                              │
     └──────────────────────────────┘ └──────────────────────────────┘ └──────────────────────────────┘
                    │                                  │                                  │
                    └──────────────────────────────────┴──────────────────────────────────┘
                                                       │
                                    ┌──────────────────┴──────────────────┐
                                    │        SHARED STORAGE               │
                                    │     VMDisks (NFS - Synology)        │
                                    │        192.168.20.31                │
                                    └─────────────────────────────────────┘
```

---

## Kubernetes Cluster

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    KUBERNETES CLUSTER v1.28.15                                                   │
│                                         (All on Node03)                                                          │
├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                  │
│                                    ┌─────────────────────────────────┐                                          │
│                                    │      CONTROL PLANE (HA)         │                                          │
│                                    │     Pod Network: 10.244.0.0/16  │                                          │
│                                    │         CNI: Calico v3.27       │                                          │
│                                    └─────────────────────────────────┘                                          │
│                                                    │                                                             │
│            ┌───────────────────────────────────────┼───────────────────────────────────────┐                    │
│            │                                       │                                       │                    │
│            ▼                                       ▼                                       ▼                    │
│  ┌──────────────────────┐            ┌──────────────────────┐            ┌──────────────────────┐              │
│  │  k8s-controller01    │            │  k8s-controller02    │            │  k8s-controller03    │              │
│  │   192.168.20.32      │◄──────────►│   192.168.20.33      │◄──────────►│   192.168.20.34      │              │
│  │   2 cores, 4GB RAM   │   etcd     │   2 cores, 4GB RAM   │   etcd     │   2 cores, 4GB RAM   │              │
│  │   (Primary)          │   sync     │   (HA)               │   sync     │   (HA)               │              │
│  └──────────────────────┘            └──────────────────────┘            └──────────────────────┘              │
│                                                    │                                                             │
│                                                    │ kubectl / API                                               │
│                                                    ▼                                                             │
│  ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                        WORKER NODES                                                        │  │
│  ├───────────────────────────────────────────────────────────────────────────────────────────────────────────┤  │
│  │                                                                                                            │  │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐         │  │
│  │  │ k8s-worker01│ │ k8s-worker02│ │ k8s-worker03│ │ k8s-worker04│ │ k8s-worker05│ │ k8s-worker06│         │  │
│  │  │ .20.40      │ │ .20.41      │ │ .20.42      │ │ .20.43      │ │ .20.44      │ │ .20.45      │         │  │
│  │  │ 2C/4GB      │ │ 2C/4GB      │ │ 2C/4GB      │ │ 2C/4GB      │ │ 2C/4GB      │ │ 2C/4GB      │         │  │
│  │  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘         │  │
│  │                                                                                                            │  │
│  │  Container Runtime: containerd v1.7.28                                                                    │  │
│  │  Cgroup Driver: systemd                                                                                   │  │
│  │                                                                                                            │  │
│  └───────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

                                    ┌─────────────────────────────────┐
                                    │      ANSIBLE CONTROLLER         │
                                    │    ansible-controller01         │
                                    │      192.168.20.30              │
                                    │   (Manages K8s deployment)      │
                                    └─────────────────────────────────┘
```

---

## Application Services

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        APPLICATION SERVICES MAP                                                  │
│                                            VLAN 40 Services                                                      │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

                                         ┌─────────────────────────┐
                                         │   External Requests     │
                                         │   *.hrmsmrflrii.xyz     │
                                         └───────────┬─────────────┘
                                                     │
                                                     ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                     TRAEFIK REVERSE PROXY                                                        │
│                                      traefik-vm01 (.40.20)                                                       │
│                                                                                                                  │
│  Ports: 80 (HTTP→HTTPS), 443 (HTTPS), 8080 (Dashboard)                                                          │
│  SSL: Let's Encrypt wildcard via Cloudflare DNS-01                                                              │
│                                                                                                                  │
│  Routes:                                                                                                         │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │ proxmox.hrmsmrflrii.xyz  → 192.168.20.21:8006  │  jellyfin.hrmsmrflrii.xyz   → 192.168.40.11:8096        │ │
│  │ auth.hrmsmrflrii.xyz     → 192.168.40.21:9000  │  radarr.hrmsmrflrii.xyz     → 192.168.40.11:7878        │ │
│  │ photos.hrmsmrflrii.xyz   → 192.168.40.22:2283  │  sonarr.hrmsmrflrii.xyz     → 192.168.40.11:8989        │ │
│  │ gitlab.hrmsmrflrii.xyz   → 192.168.40.23:80    │  prowlarr.hrmsmrflrii.xyz   → 192.168.40.11:9696        │ │
│  │ n8n.hrmsmrflrii.xyz      → 192.168.40.10:5678  │  bazarr.hrmsmrflrii.xyz     → 192.168.40.11:6767        │ │
│  │ paperless.hrmsmrflrii.xyz→ 192.168.40.10:8000  │  jellyseerr.hrmsmrflrii.xyz → 192.168.40.11:5056        │ │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                                     │
        ┌────────────────────────────────────────────┼────────────────────────────────────────────┐
        │                                            │                                            │
        ▼                                            ▼                                            ▼
┌───────────────────┐                    ┌───────────────────┐                    ┌───────────────────┐
│   IDENTITY &      │                    │    MEDIA &        │                    │   DEVELOPMENT &   │
│   SECURITY        │                    │    STORAGE        │                    │   PRODUCTIVITY    │
├───────────────────┤                    ├───────────────────┤                    ├───────────────────┤
│                   │                    │                   │                    │                   │
│ ┌───────────────┐ │                    │ ┌───────────────┐ │                    │ ┌───────────────┐ │
│ │  Authentik    │ │                    │ │   Immich      │ │                    │ │    GitLab     │ │
│ │  .40.21:9000  │ │                    │ │  .40.22:2283  │ │                    │ │  .40.23:80    │ │
│ │  SSO/IdP      │ │                    │ │  Photos/Video │ │                    │ │  Git/CI/CD    │ │
│ └───────────────┘ │                    │ └───────────────┘ │                    │ └───────────────┘ │
│                   │                    │                   │                    │                   │
│                   │                    │ ┌───────────────┐ │                    │ ┌───────────────┐ │
│                   │                    │ │  Arr Stack    │ │                    │ │     n8n       │ │
│                   │                    │ │  .40.11       │ │                    │ │  .40.10:5678  │ │
│                   │                    │ │  Media Mgmt   │ │                    │ │  Automation   │ │
│                   │                    │ └───────────────┘ │                    │ └───────────────┘ │
│                   │                    │                   │                    │                   │
│                   │                    │                   │                    │ ┌───────────────┐ │
│                   │                    │                   │                    │ │ Paperless-ngx │ │
│                   │                    │                   │                    │ │  .40.10:8000  │ │
│                   │                    │                   │                    │ │  Documents    │ │
│                   │                    │                   │                    │ └───────────────┘ │
│                   │                    │                   │                    │                   │
└───────────────────┘                    └───────────────────┘                    └───────────────────┘
```

---

## Arr Media Stack Connections

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                               ARR MEDIA STACK - docker-vm-media01 (192.168.40.11)                               │
│                                           Docker Network: arr-network                                            │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

                                    ┌─────────────────────────────────┐
                                    │          PROWLARR               │
                                    │     (Indexer Manager)           │
                                    │         :9696                   │
                                    │  API: e5f64c69e6c04bd8...       │
                                    └─────────────────┬───────────────┘
                                                      │
                                          Full Sync   │   (Indexers auto-sync)
                                                      │
                    ┌─────────────────────────────────┼─────────────────────────────────┐
                    │                                 │                                 │
                    ▼                                 ▼                                 ▼
     ┌──────────────────────────┐    ┌──────────────────────────┐    ┌──────────────────────────┐
     │         RADARR           │    │         SONARR           │    │         LIDARR           │
     │     (Movie Manager)      │    │      (TV Manager)        │    │     (Music Manager)      │
     │         :7878            │    │         :8989            │    │         :8686            │
     │  API: 21f807cf2869...    │    │  API: 50c598d01b29...    │    │  API: 13fe89b5dbdb...    │
     │                          │    │                          │    │                          │
     │  Root: /movies           │    │  Root: /tv               │    │  Root: /music            │
     └────────────┬─────────────┘    └────────────┬─────────────┘    └──────────────────────────┘
                  │                               │
                  │         API Connection        │
                  │    ┌──────────────────────────┤
                  │    │                          │
                  ▼    ▼                          │
     ┌──────────────────────────┐                 │
     │         BAZARR           │                 │
     │   (Subtitle Manager)     │                 │
     │         :6767            │◄────────────────┘
     │  API: 6c0037b075a3...    │
     │                          │
     │  Connected to:           │
     │  - radarr:7878 ✅        │
     │  - sonarr:8989 ✅        │
     │                          │
     │  ⚠️ Needs: Language      │
     │     Profile Setup        │
     └──────────────────────────┘

                    ┌─────────────────────────────────┐
                    │                                 │
                    ▼                                 │
     ┌──────────────────────────┐                    │
     │        JELLYFIN          │                    │
     │     (Media Server)       │                    │
     │         :8096            │                    │
     │                          │                    │
     │  Libraries:              │                    │
     │  - /data/movies          │                    │
     │  - /data/tvshows         │                    │
     │                          │                    │
     │  ⚠️ Needs: Startup       │                    │
     │     Wizard Completion    │                    │
     └────────────┬─────────────┘                    │
                  │                                  │
                  │ (After Jellyfin setup)          │
                  ▼                                  │
     ┌──────────────────────────┐                    │
     │       JELLYSEERR         │────────────────────┘
     │    (Request Manager)     │    (After setup)
     │         :5056            │
     │                          │
     │  ⚠️ Needs Setup:         │
     │  - Connect to Jellyfin   │
     │  - Add Radarr server     │
     │  - Add Sonarr server     │
     └──────────────────────────┘


     ┌──────────────────────────────────────────────────────────────────────────────┐
     │                           ADDITIONAL SERVICES                                 │
     ├──────────────────────────────────────────────────────────────────────────────┤
     │                                                                              │
     │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐              │
     │  │     TDARR       │  │    AUTOBRR      │  │   OVERSEERR     │              │
     │  │  (Transcode)    │  │ (IRC Announce)  │  │ (Plex Requests) │              │
     │  │     :8265       │  │     :7474       │  │     :5055       │              │
     │  └─────────────────┘  └─────────────────┘  └─────────────────┘              │
     │                                                                              │
     └──────────────────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                       CONNECTION STATUS SUMMARY                                                  │
├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                  │
│  ✅ CONFIGURED (via API - December 19, 2025):                                                                   │
│     • Prowlarr → Radarr (Full Sync, Movies categories)                                                          │
│     • Prowlarr → Sonarr (Full Sync, TV categories)                                                              │
│     • Prowlarr → Lidarr (Full Sync, Audio categories)                                                           │
│     • Bazarr → Radarr (radarr:7878)                                                                             │
│     • Bazarr → Sonarr (sonarr:8989)                                                                             │
│                                                                                                                  │
│  ⚠️ NEEDS MANUAL SETUP:                                                                                         │
│     • Jellyfin - Complete startup wizard, add libraries                                                         │
│     • Bazarr - Create language profile                                                                          │
│     • Jellyseerr - Complete wizard, connect to Jellyfin + Radarr/Sonarr                                         │
│     • Prowlarr - Add indexers (connections ready to sync)                                                       │
│                                                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## Storage Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                         STORAGE ARCHITECTURE                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

                                    ┌─────────────────────────────────┐
                                    │       SYNOLOGY NAS              │
                                    │       192.168.20.31             │
                                    │                                 │
                                    │  Total Capacity: ~10TB          │
                                    │  RAID: SHR (Synology Hybrid)    │
                                    └─────────────────┬───────────────┘
                                                      │
                    ┌─────────────────────────────────┼─────────────────────────────────┐
                    │                                 │                                 │
                    ▼                                 ▼                                 ▼
     ┌──────────────────────────┐    ┌──────────────────────────┐    ┌──────────────────────────┐
     │    PROXMOX-MANAGED       │    │     MANUAL NFS MOUNTS    │    │    APPLICATION DATA      │
     │       STORAGE            │    │                          │    │                          │
     ├──────────────────────────┤    ├──────────────────────────┤    ├──────────────────────────┤
     │                          │    │                          │    │                          │
     │ VMDisks (NFS)            │    │ Proxmox-Media            │    │ ProxmoxData              │
     │ /volume2/ProxmoxCluster- │    │ /volume2/Proxmox-Media   │    │ /volume2/ProxmoxData     │
     │         VMDisks          │    │                          │    │                          │
     │                          │    │ Mount: /mnt/nfs/media    │    │ Mount: /mnt/appdata      │
     │ Content: VM Disks        │    │ (on Proxmox nodes)       │    │ (on Immich VM)           │
     │                          │    │                          │    │                          │
     │ Used by:                 │    │ Mount: /mnt/media        │    │ Used by:                 │
     │ - All VMs                │    │ (on Docker hosts)        │    │ - Immich photos (7TB)    │
     │ - Cloud-init drives      │    │                          │    │                          │
     │ - EFI disks              │    │ Content:                 │    │                          │
     │                          │    │ - /Movies                │    │                          │
     │ ─────────────────────    │    │ - /Series                │    │                          │
     │                          │    │ - /Music                 │    │                          │
     │ ISOs (NFS)               │    │ - /Downloads             │    │                          │
     │ /volume2/ProxmoxCluster- │    │                          │    │                          │
     │         ISOs             │    │ Used by:                 │    │                          │
     │                          │    │ - Arr Stack              │    │                          │
     │ Content: ISO images      │    │ - Jellyfin               │    │                          │
     │                          │    │ - Tdarr                  │    │                          │
     │                          │    │                          │    │                          │
     └──────────────────────────┘    └──────────────────────────┘    └──────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        LOCAL STORAGE ON VMs                                                      │
├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                  │
│  docker-vm-media01 (.40.11):                     docker-vm-utilities01 (.40.10):                                │
│  /opt/arr-stack/                                  /opt/n8n/                                                      │
│  ├── jellyfin/config/                            /opt/paperless/                                                 │
│  ├── radarr/                                     /opt/glance/                                                    │
│  ├── sonarr/                                                                                                     │
│  ├── lidarr/                                     traefik-vm01 (.40.20):                                         │
│  ├── prowlarr/                                   /opt/traefik/                                                   │
│  ├── bazarr/                                     ├── config/traefik.yml                                         │
│  ├── jellyseerr/                                 ├── config/dynamic/services.yml                                │
│  ├── tdarr/                                      └── certs/acme.json                                            │
│  └── autobrr/                                                                                                    │
│                                                   authentik-vm01 (.40.21):                                       │
│  immich-vm01 (.40.22):                           /opt/authentik/                                                 │
│  /opt/immich/                                                                                                    │
│  ├── postgres/                                   gitlab-vm01 (.40.23):                                          │
│  ├── model-cache/                                /opt/gitlab/                                                    │
│  └── .secrets                                    ├── config/                                                     │
│                                                   ├── logs/                                                       │
│                                                   └── data/                                                       │
│                                                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## Traffic Flow

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    EXTERNAL ACCESS FLOW                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

    User Request                                                                         Backend Service
    ─────────────                                                                        ───────────────
        │
        │  1. DNS Query: jellyfin.hrmsmrflrii.xyz
        ▼
┌───────────────────┐
│    Cloudflare     │  ◄── Domain: hrmsmrflrii.xyz (GoDaddy → Cloudflare)
│       DNS         │
└─────────┬─────────┘
          │
          │  2. Returns: 192.168.40.20 (Traefik IP via OPNsense DNS)
          ▼
┌───────────────────┐
│  OPNsense DNS     │  ◄── Host overrides: *.hrmsmrflrii.xyz → 192.168.40.20
│   192.168.91.30   │
└─────────┬─────────┘
          │
          │  3. HTTPS Request to Traefik
          ▼
┌───────────────────┐
│     TRAEFIK       │
│  192.168.40.20    │
│   :443 (HTTPS)    │
│                   │
│  ┌─────────────┐  │
│  │ SSL Cert    │  │  ◄── Let's Encrypt wildcard (*.hrmsmrflrii.xyz)
│  │ (acme.json) │  │      via Cloudflare DNS-01 challenge
│  └─────────────┘  │
│                   │
│  ┌─────────────┐  │
│  │ Router:     │  │
│  │ Host match  │  │  4. Route based on hostname
│  └─────────────┘  │
└─────────┬─────────┘
          │
          │  5. Forward to backend (HTTP internal)
          ▼
┌───────────────────┐
│   JELLYFIN        │
│ 192.168.40.11     │
│     :8096         │
└───────────────────┘


┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    INTERNAL MANAGEMENT FLOW                                                      │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

                                    ┌─────────────────────────────────┐
                                    │      ANSIBLE CONTROLLER         │
                                    │     192.168.20.30               │
                                    │                                 │
                                    │  ~/ansible/                     │
                                    │  - inventory.ini                │
                                    │  - playbooks/                   │
                                    └─────────────────┬───────────────┘
                                                      │
                                                      │ SSH (key-based)
                                                      │
            ┌─────────────────────────────────────────┼─────────────────────────────────────────┐
            │                                         │                                         │
            ▼                                         ▼                                         ▼
┌───────────────────────┐               ┌───────────────────────┐               ┌───────────────────────┐
│    VLAN 20 Hosts      │               │    VLAN 40 Hosts      │               │    Synology NAS       │
│                       │               │                       │               │    192.168.20.31      │
│ - K8s Controllers     │               │ - traefik-vm01        │               │                       │
│ - K8s Workers         │               │ - authentik-vm01      │               │    SSH Port: 14       │
│ - Proxmox Nodes       │               │ - immich-vm01         │               │    Key: nas_automation│
│                       │               │ - gitlab-vm01         │               │                       │
│                       │               │ - docker-vm-*         │               │    Playbooks:         │
│                       │               │                       │               │ - NFS permissions     │
└───────────────────────┘               └───────────────────────┘               └───────────────────────┘
```

---

## DNS & SSL Flow

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                         DNS & SSL ARCHITECTURE                                                   │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                              DNS RESOLUTION                                                      │
├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                  │
│   External (Internet):                           Internal (LAN):                                                │
│   ─────────────────────                          ────────────────                                                │
│                                                                                                                  │
│   1. Domain: hrmsmrflrii.xyz                     1. DNS Server: 192.168.91.30 (OPNsense)                        │
│      Registrar: GoDaddy                                                                                          │
│      Nameservers: Cloudflare                     2. Host Overrides (Unbound):                                   │
│                                                     *.hrmsmrflrii.xyz → 192.168.40.20                           │
│   2. Cloudflare manages:                                                                                         │
│      - DNS records                               3. All internal clients use OPNsense DNS                       │
│      - API for DNS-01 challenge                     which returns Traefik IP for all                            │
│      - Proxy disabled (DNS only)                    homelab subdomains                                          │
│                                                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                           SSL CERTIFICATE FLOW                                                   │
├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                  │
│       TRAEFIK                          CLOUDFLARE                      LET'S ENCRYPT                            │
│       ───────                          ──────────                      ─────────────                            │
│                                                                                                                  │
│   ┌─────────────┐                  ┌─────────────┐                  ┌─────────────┐                             │
│   │   Request   │  ──────────────► │   API Call  │ ───────────────► │   Verify    │                             │
│   │  Wildcard   │   DNS-01         │  Create TXT │   Check TXT      │   Domain    │                             │
│   │    Cert     │   Challenge      │   Record    │   Record         │  Ownership  │                             │
│   └─────────────┘                  └─────────────┘                  └─────────────┘                             │
│         │                                                                  │                                     │
│         │                                                                  │                                     │
│         │                          ┌─────────────┐                         │                                     │
│         │                          │  Remove TXT │ ◄───────────────────────┘                                     │
│         │                          │   Record    │   Validation                                                  │
│         │                          └─────────────┘   Complete                                                    │
│         │                                                                                                        │
│         ▼                                                                                                        │
│   ┌─────────────┐                                                                                                │
│   │   Store     │                                                                                                │
│   │  Certificate│   /opt/traefik/certs/acme.json                                                                │
│   │  (Wildcard) │   *.hrmsmrflrii.xyz                                                                           │
│   └─────────────┘                                                                                                │
│                                                                                                                  │
│   Certificate auto-renews before expiration (90 days)                                                           │
│                                                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                         SERVICE URL MAPPING                                                      │
├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                  │
│   INFRASTRUCTURE                              MEDIA SERVICES                                                     │
│   ──────────────                              ──────────────                                                     │
│   proxmox.hrmsmrflrii.xyz  → .20.21:8006     jellyfin.hrmsmrflrii.xyz   → .40.11:8096                          │
│   node01.hrmsmrflrii.xyz   → .20.20:8006     radarr.hrmsmrflrii.xyz     → .40.11:7878                          │
│   node02.hrmsmrflrii.xyz   → .20.21:8006     sonarr.hrmsmrflrii.xyz     → .40.11:8989                          │
│   node03.hrmsmrflrii.xyz   → .20.22:8006     lidarr.hrmsmrflrii.xyz     → .40.11:8686                          │
│   traefik.hrmsmrflrii.xyz  → .40.20:8080     prowlarr.hrmsmrflrii.xyz   → .40.11:9696                          │
│                                               bazarr.hrmsmrflrii.xyz     → .40.11:6767                          │
│   CORE SERVICES                               jellyseerr.hrmsmrflrii.xyz → .40.11:5056                          │
│   ─────────────                               tdarr.hrmsmrflrii.xyz      → .40.11:8265                          │
│   auth.hrmsmrflrii.xyz     → .40.21:9000     autobrr.hrmsmrflrii.xyz    → .40.11:7474                          │
│   photos.hrmsmrflrii.xyz   → .40.22:2283                                                                        │
│   gitlab.hrmsmrflrii.xyz   → .40.23:80       UTILITY SERVICES                                                   │
│                                               ────────────────                                                   │
│                                               paperless.hrmsmrflrii.xyz  → .40.10:8000                          │
│                                               glance.hrmsmrflrii.xyz     → .40.10:8080                          │
│                                               n8n.hrmsmrflrii.xyz        → .40.10:5678                          │
│                                                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## Quick Reference Tables

### IP Address Summary

| Range | Purpose | Examples |
|-------|---------|----------|
| 192.168.20.20-22 | Proxmox Nodes | node01, node02, node03 |
| 192.168.20.30 | Ansible Controller | ansible-controller01 |
| 192.168.20.31 | Synology NAS | Storage |
| 192.168.20.32-34 | K8s Control Plane | k8s-controller01-03 |
| 192.168.20.40-45 | K8s Workers | k8s-worker01-06 |
| 192.168.40.5 | Logging | linux-syslog-server01 |
| 192.168.40.10-11 | Docker Hosts | utilities01, media01 |
| 192.168.40.20-23 | App Services | Traefik, Authentik, Immich, GitLab |
| 192.168.91.30 | OPNsense | Firewall/DNS |

### Port Reference

| Port | Service | Host |
|------|---------|------|
| 80/443 | Traefik | 192.168.40.20 |
| 8080 | Traefik Dashboard | 192.168.40.20 |
| 8006 | Proxmox Web UI | 192.168.20.20-22 |
| 9000 | Authentik | 192.168.40.21 |
| 2283 | Immich | 192.168.40.22 |
| 80/2222 | GitLab | 192.168.40.23 |
| 8096 | Jellyfin | 192.168.40.11 |
| 7878 | Radarr | 192.168.40.11 |
| 8989 | Sonarr | 192.168.40.11 |
| 9696 | Prowlarr | 192.168.40.11 |
| 5678 | n8n | 192.168.40.10 |

---

*Generated: December 19, 2025*
*Infrastructure managed via Terraform + Ansible*
